version: '3'
services:
  redis:
    image: mcr.microsoft.com/oss/bitnami/redis:6.0.8
    container_name: redis
    restart: always
    environment:
      ALLOW_EMPTY_PASSWORD: "yes"

  backend-api:
    build: .
    image: tiangolo/uvicorn-gunicorn-fastapi:python3.7
    container_name: backend-api
    domainname: gruff-main-backend
    environment:
      REDIS: redis
    ports:
        - "80:80"
    deploy:
      resources:
        reservations:
          cpus: '1.5'
          memory: 1.5G
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
